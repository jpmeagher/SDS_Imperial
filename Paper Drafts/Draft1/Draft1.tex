%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Review Volume (last updated on 20-4-2015)                            %%
%% Trim Size: 9in x 6in                                                 %%
%% Text Area: 7.35in (include runningheads) x 4.5in                     %%
%% Main Text: 10 on 13pt                                                %%
%% For support: Yolande Koh, <ykoh@wspc.com.sg>                         %%
%%              D. Rajesh Babu, <rajesh@wspc.com.sg>                    %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
\documentclass[wsdraft]{ws-rv9x6} % to draw border line around text area
%\documentclass{ws-rv9x6}
\usepackage{subfigure}   % required only when side-by-side / subfigures are used
\usepackage{ws-rv-thm}   % comment this line when `amsthm / theorem / ntheorem` package is used
\usepackage{ws-rv-van}   % numbered citation & references (default)
%\usepackage{ws-index}   % to produce multiple indexes
\makeindex
%\newindex{aindx}{adx}{and}{Author Index}       %author index
%\renewindex{default}{idx}{ind}{Subject Index}  %subject index

\begin{document}

\chapter[Ancestral Reconstruction of Bat Echolocation Calls]{Ancestral Reconstruction of Bat Echolocation Calls}\label{ra_ch1}

\author[J.P. Meagher et al.]{J.P. Meagher\footnote{Author footnote.}}
%\index[aindx]{Author, F.} % or \aindx{Author, F.}
%\index[aindx]{Author, S.} % or \aindx{Author, S.}

\address{Department of Statistics,\\
University of Warwick, \\
J.Meagher@Warwick.ac.uk\footnote{Affiliation footnote.}}

\begin{abstract}
 Something something bats something evolution something ancestral reconstruction something magic.
\end{abstract}
%\markright{Customized Running Head for Odd Page} % default is Chapter Title.
\body

%\tableofcontents
\section{Introduction}

Advances in technology allowing the precise quantification and storage of information about the world around us continues to drive the emergence of Data Science as a discipline distinct from both Statistics and Computer Science.

Bioacoustics is one area of research generating vast quantities of data which also captures the imagination of the public, as evidenced by successful citizen science initiatives. \cite{allen2006citizen} \cite{pettorelli2013indicator} Bioacoustic techniques for biodiversity monitoring \cite{stathopoulos2017bat} \cite{damoulas2010bayesian} have the potential to make real policy impacts, particularly with regard to sustainable economic development and nature conservation.

In the acoustic monitoring of biodiversity, bats (order \textit{Chiroptera}) are of particular interest. Bats have been identified as ideal bioindicators for monitoring climate change and habitat quality,\cite{jones2009carpe} largely because bats broadcast information about themselves into their environment in the form of echolocation calls.\cite{jones2005echolocation} The development of automatic acoustic monitoring algorithms for classifying species of bats \cite{stathopoulos2017bat} \cite{walters2012continental} means that large scale, non-invasive monitoring is becoming possible. 

While monitoring bat populations provides useful information, understanding the root causes and effects of what is observed requires that the natural history of extant bat species is also well understood. Traits, such as call structure or body size, exhibited by particular bat species are linked to the bats interactions with its environment. \cite{aldridge1987morphology} Existing fossil records are of limited use in inferring the traits exhibited by ancestral bats, particularly with respect to echolocation calls. The reconstruction of ancestral traits relies heavily on the comparative analysis\cite{felsenstein2004inferring} of extant bat species. Thus, statistical data science techniques may be particularly useful for inferring the evolutionary dynamics and reconstructing ancestral states of echolocation in bats.

Previous studies of bat echolocation calls for both classification \cite{walters2012continental} and ancestral reconstruction \cite{collen2012evolution} examined features of the call extracted from the call spectrogram. These, somewhat arbitrary, call features relied on significant domain knowledge to ensure they were sensibly selected and used. More recently however, general techniques for the classification of acoustic signals have been developed. \cite{stathopoulos2014bat} \cite{damoulas2010bayesian} These methods do not require, but can be augmented by, domain knowledge. General techniques for ancestral reconstruction of function-valued traits, such as speech sounds or echolocation calls, have been proposed \cite{group2012phylogenetic}. The study of bat echolocation calls offers an opportunity to examine the efficacy of these techniques.

A function-valued trait is measured along some continuous scale, usually time, and can then be modelled as a continuous mathematical function using techniques for functional data analysis. \cite{ramsay2006functional} Jones \& Moriarty \cite{jones2013evolutionary} developed a method which extends Gaussian Process Regression \cite{rasmussen2006gaussian} to model the evolution of function-valued traits over a phylogeny. The model facilitates the implementation of two popular models for continuous character state evolution,\cite{joy2016ancestral} the Brownian Motion and Ornstein-Uhlenbeck models.\cite{lande1976natural} A full demonstration of ancestral reconstruction for synthetic data using the method was presented by Hajipantelis et al.\cite{hadjipantelis2013function}

This general approach to evolutionary inference for function-valued traits is implemented here for a set of bat echolocation calls. Our goal in doing so is twofold. These techniques had previously been considered in the context of modelling the evolution of human speech sounds in language. \cite{group2012phylogenetic} It is hoped that by applying these methods in the simpler context of the evolution of bat echolocation calls that progress can be made towards resolving methodological problems. For example, how do we extend these methods to more realistic models of evolution?  

We are also interested in what specifically these models tell us about bats and the evolutionary dynamics driving the development of echolocation. What impact might these results have on our understanding of ancestral bats and their behaviour?

This paper presents the early stages of our research and some preliminary results.

\section{Functional Representation of Bat Echolocation Calls}

A functional data object is generated when repeated measurements of some process are taken along a continuous scale, such as time. \cite{ramsay2006functional} 
These measurements can be thought of as representing points on a curve that varies gradually and continuously. In the context of phylogenetics, these functional data objects are called function-valued traits. \cite{meyer2005up}

Denote the \(m^{th}\) call recording of the \(l^{th}\) individual bat of species \(S\) by \(\{\tilde{x}_{lm}^S(n) : n = 0, \dots, N_{lm}^S - 1\}\). 
Thus \(\{\tilde{x}_{lm}^S(\cdot)\}\) is a noisy realisation of \(x^S(\cdot)\), the echolocation call generating process for species \(S\), observed at the time points given by \(\frac{n}{f_S}\), where \(f_S\) is the process sampling rate in samples per second (Hz).

Call recordings themselves are in fact functional data objects, however modelling the phylogenetic relationships between \(\{\tilde{x}_{lm}^S(\cdot)\}\) and \(\{\tilde{x}_{l'm'}^{S'}(\cdot)\}\) directly implies that the processes are comparable at point \(n\). 
This is not the case for acoustic signals, which are sinusoidal and can vary in time without significantly altering the information carried. Thus some alternative functional representation of the signal is required. 

The discrete Fourier transform of the signal \(\{\tilde{x}_{l'm'}^{S'}(\cdot)\}\) is given by\[\tilde{X}_{lm}^S(k) = \sum_{n = 0}^{N_{lm}^S - 1} \tilde{x}_{lm}^{S}(n) e^{-i2\pi kn / N_{lm}^S }.\] 
The energy spectral density of this signal is the magnitude of the Fourier transform and so the log energy spectral density per second (in decibel) is estimated by \[\tilde{\mathcal{E}}_{lm}^S(k) = 10 \log_{10} \left( \frac{|\tilde{X}_{lm}^S(k)|f_s}{N_{lm}^S}\right).\]
The log energy spectral density estimate for the signal \(\tilde{x}_{lm}^S(\cdot)\), \(\tilde{\mathcal{E}}_{lm}^S(\cdot)\) is now considered to be a noisy estimate of the log energy spectral density for species \(S\), denoted \(\mathcal{E}^S(\cdot)\). The log energy spectral density is a periodic function of frequency which describes the energy of a signal at each frequency on the interval \(F = [0, \frac{f_S}{2}]\). \(\tilde{\mathcal{E}}_{lm}^S(\cdot)\) has been mapped to the decibel scale and also scaled according to the length, in time, of \(\tilde{x}_{lm}^S(\cdot)\).\cite{antoniou2006digital} We have now mapped each echolocation call on the same scale and \(\tilde{\mathcal{E}}_{lm}^S(\cdot)\) is now comparable to \(\tilde{\mathcal{E}}_{l'm'}^{S'}(f)\) at frequency \(f\). In order for these representations to be considered as function-valued traits however, \(\tilde{\mathcal{E}}_{lm}^S(\cdot)\) must be smoothed such the call representation in the frequency domain varies gradually and continuously.

The smoothed log energy spectral density is estimated by smoothing splines where \[
\mathcal{E}_{lm}^S(f) = \arg \min_{\mathcal{E}_{lm}^S(\cdot)} \int_{0}^{\frac{f_S}{2}}  \{ \tilde{\mathcal{E}}_{lm}^S(\cdot) - \mathcal{E}_{lm}^S(f) \}^2 df + \lambda \int_{0}^{\frac{f_S}{2}} \{ {\mathcal{E}_{lm}^{S}}'' (f)\}^2 df.
\]
The smoothing parameter \(\lambda\) is chosen using a generalised cross-validation procedure.\cite{friedman2001elements} \cite{citeR}

We now have a functional representation of each bats echolocation call where the pairs of observations \(\{f, \mathcal{E}_{lm}^S(f)\}\) and \(\{f, \mathcal{E}_{l'm'}^{S'}(f)\}\) are directly comparable. The function-valued traits can now be modelled for evolutionary inference.

\section{Phylogenetic Gaussian Process Regression for Bat Echolocation Calls} 

\subsection{Gaussian Process Regression on Phylogenies}

The key innovation of Jones \& Moriarty\cite{jones2013evolutionary} in extending Gaussian Process Regression \cite{rasmussen2006gaussian} for use in evolutionary inference, was to replace the linear measure of distance between observations with a phylogenetic tree, denoted \(\mathbf{T}\). When this condition is imposed each of our observations \(\mathcal{E}^{S}(f)\) correspond to a point \((f, \mathbf{t})\) on the frequency-phylogeny \(F \times \mathbf{T}\). It is then by constructing a phylogenetic covariance function \(\Sigma_{\mathbf{T}}\left(\mathcal{E}^{S}(\cdot), \mathcal{E}^{S'}(\cdot)\right)\) that evolutionary inference can be performed.

Deriving a tractable form of the phylogenetic covariance function requires some simplifying assumptions. Firstly, it is assumed that conditional on their common ancestors in the phylogenetic tree \(\mathbf{T}\), any two traits are statistically independent. 

The second assumption is that the statistical relationship between a trait and any of it's descendants in \(\mathbf{T}\) is independent of the topology of \(\mathbf{T}\). That is to say that the underlying process driving evolutionary changes is identical along all individual branches of the tree. We call this underlying process along each branch the marginal process. The marginal process depends on the date of \(\mathbf{t}\), the distance between a point \(\mathbf{t} \in \mathbf{T}\) and the root of \(\mathbf{T}\), denoted \(t\). 

Finally, we assume that the covariance function of the marginal process is separable over evolutionary time and the function-valued trait space. Thus, by defining the frequency only covariance function \(K(f,f')\) and the time only covariance function \(k(t,t')\) the covariance function of the marginal process is
\[\Sigma\left((f,t), (f',t')\right) = K(f, f') k(t,t')\]

Under these conditions, Jones \& Moriarty \cite{jones2013evolutionary} show that the phylogenetic covariance function is also separable, that is\[\Sigma_{\mathbf{T}}\left((f,\mathbf{t}), (f',\mathbf{t}')\right) = K(f, f') k_{\mathbf{T}}(\mathbf{t},\mathbf{t}').\] 

It is also shown that for a phylogenetic Gaussian Process with this covariance function, \(Y\), and a degenerate Mercer kernel, \(K(\cdot, \cdot)\), there exists a set of \(n\) deterministic basis functions \(\phi_i: F \to \mathbf{R}\) and univariate Gaussian processes \(X_i\) for \(i = 1,\dots, n\) such that 
\[
g(f, \mathbf{t}) = \sum_{i = 1}^{n} \phi_i(f) X_i(\mathbf{t})
\] 
has the same distribution as \(Y\). 

Thus, given an appropriate set of basis functions, \(\phi_{\mathcal{E}} = [\phi^{\mathcal{E}}_1(\cdot), \dots, \phi^{\mathcal{E}}_n(\cdot)]\), and Gaussian Processes, \(X_{\mathcal{E}} = [X_1^{\mathcal{E}}(\cdot), \dots\ X_n^{\mathcal{E}}(\cdot)]\), the set of observations of the echolocation function-valued trait can be expressed in matrix notation as 
\[
\mathcal{E} = X_{\mathcal{E}} \phi_{\mathcal{E}}^{\mathsf{T}},
\]
where \( X_{\mathcal{E}}\) is the matrix of mixing coefficients of the fixed basis functions determining the function-valued trait. The values of \( X_{\mathcal{E}}\) are modelled as evolving by univariate phylogenetic Gaussian Processes.

\subsection{Deterministic Basis Functions}

Applying this model to observed traits requires that \(\phi\) be estimated somehow. Hajipantelis et al. \cite{hadjipantelis2013function} addressed this problem. The model outlined above implicitly assumes that the rows of \(X_{\mathcal{E}}\) are independent. This in turn implies that each of the basis, \(\phi_i(\cdot)\), evolved independently of one another. \(\hat{\phi}\), the estimate for \(\phi\), must reflect this. 

A Functional Principal Components Analysis \cite{ramsay2006functional} of the traits would return a set of orthogonal basis functions. This dimension reduction technique allows the selection of \(n\) basis functions which describe some proportion of the variation in the sample. However, this implicitly assumes that the basis functions are also Gaussian, a strong assumption which may not be realistic.

A less stringent condition is to assumes only that the basis functions are independent. Such a set of components can be found by an Independent Components Analysis. Blasche \& Wiskott\cite{blaschke2004cubica} present a method for deriving Independent Components. This two step procedure first implements a Principal Components Analysis to estimate the effective dimensionality of the dataset, before passing the effective dimensions to the CuBICA algorithm. This algorithm then rotates these effective dimensions until the third and fourth cumulants have also been diagonalised, which produces approximately independent basis functions.

\subsection{The Phylogenetic Ornstein-Uhelenbeck Process}

\bibliographystyle{ws-rv-van}
\bibliography{../BatBiblio}

%\blankpage
%\printindex[aindx]                 % to print author index
%\printindex                         % to print subject index

\end{document} 